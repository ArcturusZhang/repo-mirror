jobs:
  - job: MirrorRepos
    variables:
      skipComponentGovernanceDetection: true
    steps:
      - checkout: self
        clean: true
        fetchDepth: 2
        persistCredentials: true

      - script: echo "##vso[task.setvariable variable=dateString]$(date +%y%m%d)"
        displayName: Set Date Variable

      - task: CacheBeta@0
        inputs:
          key: cache-repos | $(dateString) | .azure-pipelines/*
          path: repos
        displayName: Cache Cloned Repos

      # - template: step-mirror.yml
      #   parameters:
      #     WORKING_DIRECTORY: repos/test-sync
      #     SOURCE_REPO: https://github.com/test-repo-billy/test-sync.git
      #     SOURCE_BRANCHES: master
      #     TARGET_ENDPOINTS: |
      #       https://github.com/test-repo-tih/test-sync.git!master
      #       https://github.com/test-repo-tih/test-sync.git!latest

      - template: step-mirror.yml
        parameters:
          WORKING_DIRECTORY: repos/azure-rest-api-specs
          SOURCE_REPO: https://github.com/Azure/azure-rest-api-specs
          SOURCE_BRANCHES: master
          TARGET_ENDPOINTS: |
            https://github.com/test-repo-tih/azure-rest-api-specs!master
            https://github.com/test-repo-billy/azure-rest-api-specs!master

      - template: step-mirror.yml
        parameters:
          WORKING_DIRECTORY: repos/azure-sdk-for-go
          SOURCE_REPO: https://github.com/Azure/azure-sdk-for-go
          SOURCE_BRANCHES: master latest
          TARGET_ENDPOINTS: |
            https://github.com/test-repo-tih/azure-sdk-for-go!master
            https://github.com/test-repo-billy/azure-sdk-for-go!master
            https://github.com/AzureSDKAutomation/azure-sdk-for-go!master
            https://github.com/test-repo-tih/azure-sdk-for-go!latest
            https://github.com/test-repo-billy/azure-sdk-for-go!latest
            https://github.com/AzureSDKAutomation/azure-sdk-for-go!latest

      - template: step-mirror.yml
        parameters:
          working_directory: repos/azure-sdk-for-js
          source_repo: https://github.com/azure/azure-sdk-for-js
          source_branches: master
          target_endpoints: |
            https://github.com/test-repo-tih/azure-sdk-for-js!master
            https://github.com/test-repo-billy/azure-sdk-for-js!master
            https://github.com/azuresdkautomation/azure-sdk-for-js!master

      - template: step-mirror.yml
        parameters:
          working_directory: repos/azure-sdk-for-net
          source_repo: https://github.com/azure/azure-sdk-for-net
          source_branches: master
          target_endpoints: |
            https://github.com/test-repo-tih/azure-sdk-for-net!master
            https://github.com/test-repo-billy/azure-sdk-for-net!master
            https://github.com/azuresdkautomation/azure-sdk-for-net!master

      - template: step-mirror.yml
        parameters:
          working_directory: repos/azure-sdk-for-python
          source_repo: https://github.com/azure/azure-sdk-for-python
          source_branches: master
          target_endpoints: |
            https://github.com/test-repo-tih/azure-sdk-for-python!master
            https://github.com/test-repo-billy/azure-sdk-for-python!master
            https://github.com/azuresdkautomation/azure-sdk-for-python!master

      - template: step-mirror.yml
        parameters:
          working_directory: repos/azure-sdk-for-java
          source_repo: https://github.com/azure/azure-sdk-for-java
          source_branches: master
          target_endpoints: |
            https://github.com/test-repo-tih/azure-sdk-for-java!master
            https://github.com/test-repo-billy/azure-sdk-for-java!master
            https://github.com/azuresdkautomation/azure-sdk-for-java!master

      - template: step-mirror.yml
        parameters:
          working_directory: repos/azure-sdk-for-ruby
          source_repo: https://github.com/azure/azure-sdk-for-ruby
          source_branches: master latest
          target_endpoints: |
            https://github.com/test-repo-tih/azure-sdk-for-ruby!master
            https://github.com/test-repo-billy/azure-sdk-for-ruby!master
            https://github.com/azuresdkautomation/azure-sdk-for-ruby!master
            https://github.com/test-repo-tih/azure-sdk-for-ruby!latest
            https://github.com/test-repo-billy/azure-sdk-for-ruby!latest
            https://github.com/azuresdkautomation/azure-sdk-for-ruby!latest
